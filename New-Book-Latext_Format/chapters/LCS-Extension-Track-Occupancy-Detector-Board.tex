## *Track Occupancy Detector Extension Board*

Track occupancy detectors are essential for building any block control or layout automation. The key idea is to divide the track into sections and then monitor each section for current consumption. The basic principle has been described in the power module chapter. When a locomotive is on the track section a current is flowing and there is a voltage drop along the diodes which is translated to a signal. With a DCC signal on the line, this task is straightforward, there is always a current flowing. In an analog track section, a stopped loco does not draw current. In such cases a very small current is sent periodically, enough to trigger the sensors but not enough to move anything.****

### *Block Diagram*

![Schematic_LcsNodes-Extension-Block-Occ-Detect-B.01.00-1.png](./Schematics/Schematic_LcsNodes-Extension-Block-Occ-Detect-B.01.00-1.png )

### *Connectors and Logic*

![Schematic_LcsNodes-Extension-Block-Occ-Detect-B.01.00-2.png](./Schematics/Schematic_LcsNodes-Extension-Block-Occ-Detect-B.01.00-2.png )

### *Detectors*

The sensor detector uses bridge rectifiers instead of discrete diodes. This allows for a rather dense packing. Bridge rectifiers are available for up to two Amps, which will be fine for a HO or smaller gauge layout. For the large scales the sensor needs to be built using discrete diodes, such as the SB560 Schottky Diode. Note also that the power for the track is not routed via the main controller board. The track power is directly connected to the extension board.

![Schematic_LcsNodes-Extension-Block-Occ-Detect-B.01.00-3.png](./Schematics/Schematic_LcsNodes-Extension-Block-Occ-Detect-B.01.00-3.png )

![Schematic_LcsNodes-Extension-Block-Occ-Detect-B.01.00-1.png](./Schematics/Schematic_LcsNodes-Extension-Block-Occ-Detect-B.01.00-4.png )

### *PCB*

![LCS-NODES-PCB-OCC-DETECT-BOARD-B.01.00.png](./Boards/LCS-NODES-PCB-OCC-DETECT-BOARD-B.01.00.png )


Firmware notes:

- I2C address considerations
- nodes and port attributes, which ones are common to all sensors ?
- periodically scan each section
- events could be fired
- control and info items to access, every group is one port

